defaults:
  logging:
    enabled: true
    retention_days: 2555
    audit_logging: true
    security_logging: true
  monitoring:
    enabled: true
    alarms:
      enabled: true
      detailed_metrics: true
      real_time_monitoring: true
  security:
    encryption:
      enabled: true
      encryption_at_rest: true
      encryption_in_transit: true
      key_rotation: true
    access_control:
      least_privilege: true
      multi_factor_auth: true
      privileged_access: true

  waf-web-acl:
    scope: REGIONAL
    defaultAction: block
    managedRuleGroups:
      - name: AWSManagedRulesCommonRuleSet
        vendorName: AWS
        priority: 1
        overrideAction: none
      - name: AWSManagedRulesKnownBadInputsRuleSet
        vendorName: AWS
        priority: 2
        overrideAction: none
      - name: AWSManagedRulesLinuxRuleSet
        vendorName: AWS
        priority: 4
        overrideAction: none
      - name: AWSManagedRulesUnixRuleSet
        vendorName: AWS
        priority: 5
        overrideAction: none
      - name: AWSManagedRulesSQLiRuleSet
        vendorName: AWS
        priority: 6
        overrideAction: none
    logging:
      enabled: true
      logDestinationType: cloudwatch
    monitoring:
      enabled: true
      alarms:
        blockedRequestsThreshold: 100

  vpc:
    cidr: 10.0.0.0/16
    maxAzs: 3
    natGateways: 3
    flowLogsEnabled: true
    flowLogRetentionDays: 2555
    vpcEndpoints:
      s3: true
      dynamodb: true
      secretsManager: true
      kms: true
    subnets:
      public:
        cidrMask: 24
      private:
        cidrMask: 24
      database:
        cidrMask: 28

  api-gateway-http:
    cors:
      allowOrigins: []
      allowHeaders:
        ["Content-Type", "Authorization", "X-Requested-With", "X-CSRF-Token"]
      allowMethods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
      allowCredentials: false
      maxAge: 86400
    throttling:
      rateLimit: 25
      burstLimit: 50
    accessLogging:
      enabled: true
      retentionInDays: 365
      includeExecutionData: true
      includeRequestResponseData: true
    monitoring:
      detailedMetrics: true
      tracingEnabled: true
      alarms:
        errorRate4xx: 1.0
        errorRate5xx: 0.1
        highLatency: 2000
        lowThroughput: 2
    security:
      enableWaf: true
      enableApiKey: true
      requireAuthorization: true

  api-gateway-rest:
    disableExecuteApiEndpoint: true
    throttling:
      rateLimit: 100
      burstLimit: 50
    logging:
      accessLoggingEnabled: true
      retentionInDays: 2555
      executionLoggingLevel: ERROR
      dataTraceEnabled: false
      metricsEnabled: true
    monitoring:
      detailedMetrics: true
      tracingEnabled: true
      thresholds:
        errorRate4xxPercent: 1
        errorRate5xxPercent: 0.1
        highLatencyMs: 1500
        lowThroughput: 2
    tracing:
      xrayEnabled: true

  s3-bucket:
    public: false
    versioning: true
    eventBridgeEnabled: false
    encryption:
      type: KMS
    security:
      blockPublicAccess: true
      requireSecureTransport: true
      requireMfaDelete: true
      denyDeleteActions: true
      tools:
        clamavScan: false
    lifecycleRules:
      - id: fedramp-high-archival
        enabled: true
        transitions:
          - storageClass: GLACIER
            transitionAfter: 90
          - storageClass: DEEP_ARCHIVE
            transitionAfter: 365
        expiration:
          days: 2555
    compliance:
      auditLogging: true
      auditBucketRetentionDays: 2555
      auditBucketObjectLock:
        enabled: true
        mode: COMPLIANCE
        retentionDays: 395
      auditBucketLifecycleRules:
        - id: fedramp-high-audit-retention
          enabled: true
          transitions:
            - storageClass: GLACIER
              transitionAfter: 90
            - storageClass: DEEP_ARCHIVE
              transitionAfter: 365
          expiration:
            days: 2555
      objectLock:
        enabled: true
        mode: COMPLIANCE
        retentionDays: 2555
    monitoring:
      enabled: true
      clientErrorThreshold: 2
      serverErrorThreshold: 1

  secrets-manager:
    automaticRotation:
      enabled: true
      rotationLambda:
        createFunction: true
        enableTracing: true
      schedule:
        automaticallyAfterDays: 30
    encryption:
      createCustomerManagedKey: true
      enableKeyRotation: true
    recovery:
      deletionProtection: true
      recoveryWindowInDays: 7
    replicas: []
    monitoring:
      enabled: true
      rotationFailureThreshold: 1
      unusualAccessThresholdMs: 3000
    accessPolicies:
      denyInsecureTransport: true
      restrictToVpce: true
      allowedVpceIds:
        - vpce-*
      requireTemporaryCredentials: true

  iam-policy:
    controls:
      denyInsecureTransport: true
      requireMfaForActions:
        - iam:*
        - kms:*
        - s3:Delete*
        - rds:Delete*
      additionalStatements: []
    logging:
      usage:
        enabled: true
        retentionInDays: 90
        removalPolicy: destroy
        tags:
          log-type: policy-usage
          retention: 90-days
      compliance:
        enabled: true
        retentionInDays: 365
        removalPolicy: retain
        logGroupNameSuffix: compliance
        tags:
          log-type: compliance
          retention: 1-year
          compliance: fedramp-high
      audit:
        enabled: true
        retentionInDays: 3653
        removalPolicy: retain
        logGroupNameSuffix: audit
        tags:
          log-type: audit
          retention: 10-years
          compliance: fedramp-high
    monitoring:
      enabled: true
      detailedMetrics: true
      usageAlarm:
        enabled: true
        threshold: 1000
        evaluationPeriods: 2
        periodMinutes: 60
        treatMissingData: not-breaching
        tags:
          metric-type: security
          compliance: fedramp-high

  rds-postgres:
    instance:
      engineVersion: '15.4'
      instanceType: r5.xlarge
      allocatedStorage: 200
      multiAz: true
      deletionProtection: true
      publiclyAccessible: false
      removalPolicy: retain
    encryption:
      enabled: true
      customerManagedKey:
        create: true
        enableRotation: true
    backup:
      retentionDays: 90
      copyTagsToSnapshots: true
    monitoring:
      enhancedMonitoring:
        enabled: true
        intervalSeconds: 1
      performanceInsights:
        enabled: true
        retentionDays: 2555
        useCustomerManagedKey: true
      alarms:
        cpuUtilization:
          enabled: true
          threshold: 70
          evaluationPeriods: 3
          comparisonOperator: gte
        freeStorageSpaceBytes:
          enabled: true
          threshold: 10737418240
          evaluationPeriods: 2
          comparisonOperator: lte
        databaseConnections:
          enabled: true
          threshold: 70
          evaluationPeriods: 2
          comparisonOperator: gte
    logging:
      database:
        enabled: true
        retentionInDays: 365
        removalPolicy: retain
      audit:
        enabled: true
        retentionInDays: 1095
        removalPolicy: retain
    rotation:
      enabled: true
      mode: single-user
      scheduleInDays: 30
    security:
      iamAuthentication: true
      enforceSsl: true
    networking:
      useDefaultVpc: true
      ingressCidrs:
        - 10.0.0.0/16
      port: 5432
    observability:
      logExports:
        - postgresql
    hardeningProfile: stig
