# RDS PostgreSQL Component

Configuration-driven RDS PostgreSQL component that consumes the platform's five-layer precedence chain. Compliance defaults (commercial, FedRAMP Moderate, FedRAMP High) live exclusively in the segregated `/config/<framework>.yml` files; the component simply consumes the resolved configuration generated by `RdsPostgresComponentConfigBuilder`.

## Features

- Engine, storage, Multi-AZ, encryption, and backup policies defined via manifest/config.
- Observability surface (enhanced monitoring, Performance Insights, log exports) controlled by configuration with sensible defaults per framework.
- Logging, audit, and rotation behaviour expressed declaratively to avoid hard-coded compliance logic.
- Capability payload exposes `securityProfile` for binder strategies and downstream consumers.

## Usage

```yaml
components:
  - name: orders-db
    type: rds-postgres
    config:
      instance:
        instanceType: r6g.large
        allocatedStorage: 100
        multiAz: true
      backup:
        retentionDays: 21
      encryption:
        enabled: true
        customerManagedKey:
          create: true
          enableRotation: true
      logging:
        database:
          enabled: true
          retentionInDays: 30
```

All unspecified properties inherit defaults from `config/<framework>.yml`, falling back to the builder's ultra-safe baseline.

## Key Configuration Sections

| Section | Description |
|---------|-------------|
| `instance` | Engine version, instance class, storage sizing, multi-AZ, deletion protection, removal policy. |
| `encryption` | Enable/disable storage encryption and decide whether to create/import a customer-managed KMS key. |
| `backup` | Retention and snapshot tagging behaviour. |
| `monitoring` | Enhanced monitoring interval, Performance Insights configuration, optional alarm thresholds. |
| `logging` | Database/audit CloudWatch log groups with retention/removal policies and tag overrides. |
| `rotation` | Secret rotation mode (`single-user`/`multi-user`) and cadence in days. |
| `security` | IAM database authentication toggle and SSL enforcement. |
| `networking` | VPC lookups, custom ingress CIDRs, and port selection. |
| `observability` | CloudWatch log exports published by the instance. |
| `hardeningProfile` | Abstract security profile surfaced via capabilities (`baseline`, `hardened`, `stig`). |

## Capabilities

- `db:postgres`
  - `host`
  - `port`
  - `dbName`
  - `secretArn`
  - `sgId`
  - `instanceArn`
  - `securityProfile`

## Tests

```bash
corepack pnpm exec jest --runTestsByPath packages/components/rds-postgres/tests/rds-postgres.builder.test.ts
corepack pnpm exec jest --runTestsByPath packages/components/rds-postgres/tests/rds-postgres.component.synthesis.test.ts
```

Ensure the appropriate `/config/<framework>.yml` entries exist when introducing new configuration knobs.
