# ElastiCache Redis Component

Synthesises an ElastiCache replication group using the platform configuration precedence chain. Defaults come from `/config/<framework>.yml`; the component consumes the resolved configuration only and never inspects `context.complianceFramework`.

## Usage Example

```yaml
components:
  - name: customer-cache
    type: elasticache-redis
    config:
      engineVersion: '7.0'
      nodeType: cache.r6g.large
      numCacheNodes: 2
      encryption:
        atRest: true
        inTransit: true
        authToken:
          enabled: true
          removalPolicy: retain
      backup:
        enabled: true
        retentionDays: 7
      monitoring:
        enabled: true
        alarms:
          cpuUtilization:
            enabled: true
            threshold: 70
``` 

## Configuration Reference

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `clusterName` | string | | Override the generated replication group identifier. |
| `engineVersion` | string | | Redis engine version (defaults per framework). |
| `nodeType` | string | | Cache node instance class. |
| `numCacheNodes` | number | | Number of cache nodes in the replication group. |
| `port` | number | | Redis port (defaults to 6379). |
| `vpc.vpcId` | string | | Explicit VPC lookup; falls back to `context.vpc` or default VPC. |
| `vpc.subnetIds` | string[] | | Override the subnets for the cache subnet group (defaults to private subnets). |
| `security.create` | boolean | | Create a dedicated security group (default `true`). |
| `security.securityGroupIds` | string[] | | Attach additional security groups. |
| `security.allowedCidrs` | string[] | | CIDR blocks allowed when the component creates the security group. |
| `parameterGroup.family` | string | | Parameter group family (default `redis7`). |
| `parameterGroup.parameters` | map | | Custom Redis parameters. |
| `encryption.atRest` | boolean | | Enable encryption at rest. |
| `encryption.inTransit` | boolean | | Enable TLS between clients and the cluster. |
| `encryption.authToken.enabled` | boolean | | Enable Redis AUTH token; creates a secret if `secretArn` is not supplied. |
| `encryption.authToken.secretArn` | string | | Use an existing Secrets Manager secret for the AUTH token. |
| `encryption.authToken.removalPolicy` | enum | | `retain` or `destroy` removal policy for generated secrets. |
| `backup.enabled` | boolean | | Toggle automatic snapshots. |
| `backup.retentionDays` | number | | Snapshot retention period (days). |
| `backup.window` | string | | Snapshot window (`HH:MM-HH:MM` UTC). |
| `maintenance.window` | string | | Maintenance window (`ddd:HH:MM-ddd:HH:MM` UTC). |
| `maintenance.notificationTopicArn` | string | | SNS topic for maintenance notifications. |
| `multiAz.enabled` | boolean | | Enable Multi-AZ deployment. |
| `multiAz.automaticFailover` | boolean | | Enable automatic failover (requires Multi-AZ). |
| `monitoring.enabled` | boolean | | Enable CloudWatch alarms/log delivery. |
| `monitoring.logDelivery[]` | object | | Declarative log delivery targets (slow/engine logs). |
| `monitoring.alarms.*` | object | | Threshold configuration for `cpuUtilization`, `cacheMisses`, `evictions`, and `connections`. |
| `tags` | map | | Additional tags merged into the replication group. |

## Capabilities

| Capability | Description |
|------------|-------------|
| `cache:redis` | Provides the replication group ID, endpoints, port, engine metadata, and auth token secret ARN (when created). |

## Construct Handles

| Handle | Description |
|--------|-------------|
| `main`, `replicationGroup` | Underlying `AWS::ElastiCache::ReplicationGroup` resource. |
| `subnetGroup` | Cache subnet group generated by the component. |
| `securityGroup` | Dedicated security group when `security.create` is `true`. |
| `parameterGroup` | Custom parameter group resource (when parameters are supplied). |
| `authToken` | Generated Secrets Manager secret for the Redis AUTH token. |
| `alarm:*` | CloudWatch alarms created from `monitoring.alarms`. |

## Platform Defaults

Platform defaults live in:

- `config/commercial.yml`
- `config/fedramp-moderate.yml`
- `config/fedramp-high.yml`

FedRAMP profiles enable encryption, Multi-AZ, enhanced backups, and monitoring out of the box. The commercial profile keeps those features optional.

## Testing

```bash
corepack pnpm exec jest --runTestsByPath \
  packages/components/elasticache-redis/tests/elasticache-redis.builder.test.ts \
  packages/components/elasticache-redis/tests/elasticache-redis.component.synthesis.test.ts --silent
```
