{
  "widgets": [
    {
      "type": "text",
      "x": 0,
      "y": 0,
      "width": 24,
      "height": 2,
      "properties": {
        "markdown": "# API Gateway HTTP - OpenTelemetry Dashboard\n\n**Service:** ${service_name} | **Environment:** ${environment} | **Last Updated:** ${timestamp}\n\nThis dashboard provides comprehensive observability for API Gateway HTTP APIs using OpenTelemetry metrics, traces, and logs. It follows AWS Well-Architected Framework best practices for operational visibility.\n\n**Key Metrics:** Request rate, error rates, latency percentiles, and business KPIs\n**Troubleshooting:** [Runbook](./README.md) | [Alarms Config](./alarms-config.json)"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 2,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [
            "AWS/ApiGateway",
            "Count",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ],
          [
            ".",
            "4XXError",
            ".",
            ".",
            ".",
            "."
          ],
          [
            ".",
            "5XXError",
            ".",
            ".",
            ".",
            "."
          ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Request Volume & Error Rates",
        "period": 300,
        "stat": "Sum",
        "yAxis": {
          "left": {
            "min": 0
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 2,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [
            "AWS/ApiGateway",
            "Latency",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ],
          [
            ".",
            "IntegrationLatency",
            ".",
            ".",
            ".",
            "."
          ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Latency Metrics (P50, P95, P99)",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0,
            "label": "Latency (ms)"
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 8,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [
            "AWS/ApiGateway",
            "4XXError",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ],
          [
            ".",
            "5XXError",
            ".",
            ".",
            ".",
            "."
          ]
        ],
        "view": "singleValue",
        "stacked": false,
        "region": "${region}",
        "title": "Error Rate % (Last 5 minutes)",
        "period": 300,
        "stat": "Average",
        "annotations": {
          "horizontal": [
            {
              "label": "4XX Threshold",
              "value": 5
            },
            {
              "label": "5XX Threshold",
              "value": 1
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 8,
      "y": 8,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [
            "AWS/ApiGateway",
            "Latency",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ]
        ],
        "view": "singleValue",
        "stacked": false,
        "region": "${region}",
        "title": "P95 Latency (ms)",
        "period": 300,
        "stat": "p95"
      }
    },
    {
      "type": "metric",
      "x": 16,
      "y": 8,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [
            "AWS/ApiGateway",
            "Count",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ]
        ],
        "view": "singleValue",
        "stacked": false,
        "region": "${region}",
        "title": "Request Count (Last 5 minutes)",
        "period": 300,
        "stat": "Sum"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 14,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apigateway/${api_id}' | fields @timestamp, @message\n| filter @message like /ERROR/ or @message like /WARN/\n| sort @timestamp desc\n| limit 100",
        "region": "${region}",
        "title": "Recent Errors & Warnings",
        "view": "table"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 20,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apigateway/${api_id}'\n| fields @timestamp, @message\n| filter @message like /4XX/ or @message like /5XX/\n| stats count() by bin(5m)\n| sort @timestamp desc",
        "region": "${region}",
        "title": "Error Trends (5XX & 4XX)",
        "view": "timeSeries"
      }
    },
    {
      "type": "log",
      "x": 12,
      "y": 20,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apigateway/${api_id}'\n| fields @timestamp, @message, @requestId\n| filter @message like /latency/\n| stats avg(latency) by bin(5m)\n| sort @timestamp desc",
        "region": "${region}",
        "title": "Latency Trends",
        "view": "timeSeries"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 26,
      "width": 24,
      "height": 6,
      "properties": {
        "metrics": [
          [
            "Custom/API-Gateway",
            "CustomMetric",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ],
          [
            "Custom/API-Gateway",
            "BusinessMetric",
            "ApiId",
            "${api_id}",
            "Stage",
            "${stage}"
          ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Custom & Business Metrics",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0,
            "label": "Custom Metrics"
          }
        }
      }
    },
    {
      "type": "alarm",
      "x": 0,
      "y": 32,
      "width": 24,
      "height": 4,
      "properties": {
        "title": "Active Alarms",
        "alarms": [
          "${alarm_4xx_high}",
          "${alarm_5xx_high}",
          "${alarm_latency_high}",
          "${alarm_low_traffic}"
        ]
      }
    }
  ],
  "variables": [
    {
      "name": "service_name",
      "type": "text",
      "defaultValue": "api-gateway-http",
      "description": "Service name for the API Gateway"
    },
    {
      "name": "environment",
      "type": "text",
      "defaultValue": "dev",
      "description": "Environment (dev, staging, prod)"
    },
    {
      "name": "api_id",
      "type": "text",
      "defaultValue": "${api_id}",
      "description": "API Gateway API ID"
    },
    {
      "name": "stage",
      "type": "text",
      "defaultValue": "${stage}",
      "description": "API Gateway stage name"
    },
    {
      "name": "region",
      "type": "text",
      "defaultValue": "${region}",
      "description": "AWS region"
    },
    {
      "name": "timestamp",
      "type": "text",
      "defaultValue": "${timestamp}",
      "description": "Dashboard last updated timestamp"
    }
  ],
  "annotations": {
    "horizontal": [
      {
        "label": "4XX Error Threshold",
        "value": 5
      },
      {
        "label": "5XX Error Threshold",
        "value": 1
      },
      {
        "label": "P95 Latency Threshold",
        "value": 1000
      }
    ]
  },
  "yAxes": {
    "left": {
      "min": 0,
      "max": 100
    },
    "right": {
      "min": 0
    }
  },
  "refresh": {
    "interval": 60
  },
  "timeRange": {
    "start": "-PT1H",
    "end": "P0D"
  },
  "timezone": "UTC"
}