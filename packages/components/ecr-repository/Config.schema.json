{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "ECR Repository Configuration",
  "description": "Configuration for creating an ECR repository with security, scanning, and lifecycle management",
  "required": [
    "repositoryName"
  ],
  "properties": {
    "repositoryName": {
      "type": "string",
      "description": "Name of the ECR repository",
      "pattern": "^[a-z0-9]([._-]?[a-z0-9])*$",
      "minLength": 2,
      "maxLength": 256
    },
    "imageScanningConfiguration": {
      "type": "object",
      "description": "Image scanning configuration for vulnerability detection",
      "properties": {
        "scanOnPush": {
          "type": "boolean",
          "description": "Enable automatic image scanning on push",
          "default": true
        }
      },
      "additionalProperties": false,
      "default": {
        "scanOnPush": true
      }
    },
    "imageTagMutability": {
      "type": "string",
      "description": "Image tag mutability setting - IMMUTABLE prevents tag overwriting",
      "enum": [
        "MUTABLE",
        "IMMUTABLE"
      ],
      "default": "MUTABLE"
    },
    "lifecyclePolicy": {
      "type": "object",
      "description": "Lifecycle management policy for automated image cleanup",
      "properties": {
        "maxImageCount": {
          "type": "number",
          "description": "Maximum number of images to keep",
          "minimum": 1,
          "maximum": 1000,
          "default": 100
        },
        "maxImageAge": {
          "type": "number",
          "description": "Maximum image age in days",
          "minimum": 1,
          "maximum": 3650,
          "default": 365
        },
        "untaggedImageRetentionDays": {
          "type": "number",
          "description": "Retention period for untagged images in days",
          "minimum": 1,
          "maximum": 365,
          "default": 7
        }
      },
      "additionalProperties": false
    },
    "repositoryPolicy": {
      "type": "object",
      "description": "IAM policy document for repository access control"
    },
    "encryption": {
      "type": "object",
      "description": "Encryption configuration for data at rest",
      "properties": {
        "encryptionType": {
          "type": "string",
          "description": "Encryption type - KMS provides customer-managed key control",
          "enum": [
            "AES256",
            "KMS"
          ],
          "default": "AES256"
        },
        "kmsKeyArn": {
          "type": "string",
          "description": "KMS key ARN for KMS encryption (required when encryptionType is KMS)"
        }
      },
      "additionalProperties": false,
      "default": {
        "encryptionType": "AES256"
      }
    },
    "monitoring": {
      "type": "object",
      "description": "Monitoring and observability configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable monitoring and observability features"
        },
        "detailedMetrics": {
          "type": "boolean",
          "default": false,
          "description": "Enable detailed CloudWatch metrics"
        },
        "logRetentionDays": {
          "type": "number",
          "description": "Log retention period in days",
          "minimum": 1,
          "maximum": 3650,
          "default": 90
        },
        "alarms": {
          "type": "object",
          "description": "CloudWatch alarm configuration",
          "properties": {
            "pushRateThreshold": {
              "type": "number",
              "description": "Threshold for image push rate alarm",
              "minimum": 1,
              "default": 50
            },
            "sizeThreshold": {
              "type": "number",
              "description": "Threshold for repository size alarm in bytes",
              "minimum": 1,
              "default": 10737418240
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "compliance": {
      "type": "object",
      "description": "Compliance configuration for regulatory requirements",
      "properties": {
        "retentionPolicy": {
          "type": "string",
          "description": "Resource retention policy for compliance",
          "enum": [
            "retain",
            "destroy"
          ],
          "default": "destroy"
        },
        "auditLogging": {
          "type": "boolean",
          "description": "Enable audit logging for compliance",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "tags": {
      "type": "object",
      "description": "Tags for the repository for organization and compliance",
      "additionalProperties": {
        "type": "string"
      },
      "default": {}
    }
  },
  "additionalProperties": false,
  "defaults": {
    "imageScanningConfiguration": {
      "scanOnPush": true
    },
    "imageTagMutability": "MUTABLE",
    "encryption": {
      "encryptionType": "AES256"
    },
    "monitoring": {
      "enabled": true,
      "detailedMetrics": false
    },
    "compliance": {
      "retentionPolicy": "destroy",
      "auditLogging": false
    },
    "tags": {}
  }
}