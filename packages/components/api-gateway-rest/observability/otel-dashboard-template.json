{
  "widgets": [
    {
      "type": "text",
      "x": 0,
      "y": 0,
      "width": 24,
      "height": 2,
      "properties": {
        "markdown": "# API Gateway REST - OpenTelemetry Dashboard\n\n**Service:** ${service_name} | **Environment:** ${environment} | **Last Updated:** ${timestamp}\n\nThis dashboard provides comprehensive observability for API Gateway REST APIs using OpenTelemetry metrics, traces, and logs. It follows AWS Well-Architected Framework best practices for operational visibility.\n\n**Key Metrics:** Request rate, error rates, latency percentiles, and business KPIs\n**Troubleshooting:** [Runbook](./README.md) | [Alarms Config](./alarms-config.json)"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 2,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "Count", "ApiName", "${api_name}", "Stage", "${stage}" ],
          [ ".", "4XXError", ".", ".", ".", "." ],
          [ ".", "5XXError", ".", ".", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Request Volume & Error Rates",
        "period": 300,
        "stat": "Sum",
        "yAxis": {
          "left": {
            "min": 0
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 2,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "Latency", "ApiName", "${api_name}", "Stage", "${stage}" ],
          [ ".", "IntegrationLatency", ".", ".", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Latency Metrics (P50, P95, P99)",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0,
            "label": "Latency (ms)"
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 8,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "4XXError", "ApiName", "${api_name}", "Stage", "${stage}" ],
          [ ".", "5XXError", ".", ".", ".", "." ]
        ],
        "view": "singleValue",
        "stacked": false,
        "region": "${region}",
        "title": "Error Rate % (Last 5 minutes)",
        "period": 300,
        "stat": "Average",
        "annotations": {
          "horizontal": [
            {
              "label": "4XX Threshold",
              "value": 5
            },
            {
              "label": "5XX Threshold", 
              "value": 1
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 8,
      "y": 8,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "Latency", "ApiName", "${api_name}", "Stage", "${stage}" ]
        ],
        "view": "singleValue",
        "stacked": false,
        "region": "${region}",
        "title": "P95 Latency (ms)",
        "period": 300,
        "stat": "p95"
      }
    },
    {
      "type": "metric",
      "x": 16,
      "y": 8,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "Count", "ApiName", "${api_name}", "Stage", "${stage}" ]
        ],
        "view": "singleValue",
        "stacked": false,
        "region": "${region}",
        "title": "Request Count (Last 5 minutes)",
        "period": 300,
        "stat": "Sum"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 14,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apigateway/${api_name}' | fields @timestamp, @message\n| filter @message like /ERROR/ or @message like /WARN/\n| sort @timestamp desc\n| limit 100",
        "region": "${region}",
        "title": "Recent Errors & Warnings",
        "view": "table"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 20,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apigateway/${api_name}'\n| fields @timestamp, @message\n| filter @message like /4XX/ or @message like /5XX/\n| stats count() by bin(5m)\n| sort @timestamp desc",
        "region": "${region}",
        "title": "Error Trends (5XX & 4XX)",
        "view": "timeSeries"
      }
    },
    {
      "type": "log",
      "x": 12,
      "y": 20,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apigateway/${api_name}'\n| fields @timestamp, @message, @requestId\n| filter @message like /latency/\n| stats avg(latency) by bin(5m)\n| sort @timestamp desc",
        "region": "${region}",
        "title": "Latency Trends",
        "view": "timeSeries"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 26,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "CacheHitCount", "ApiName", "${api_name}", "Stage", "${stage}" ],
          [ ".", "CacheMissCount", ".", ".", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Cache Performance",
        "period": 300,
        "stat": "Sum",
        "yAxis": {
          "left": {
            "min": 0,
            "label": "Cache Operations"
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 26,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "IntegrationLatency", "ApiName", "${api_name}", "Stage", "${stage}" ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Integration Latency (Backend Performance)",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0,
            "label": "Integration Latency (ms)"
          }
        }
      }
    },
    {
      "type": "alarm",
      "x": 0,
      "y": 32,
      "width": 24,
      "height": 4,
      "properties": {
        "title": "Active Alarms",
        "alarms": [
          "${alarm_4xx_high}",
          "${alarm_5xx_high}",
          "${alarm_latency_high}",
          "${alarm_low_traffic}",
          "${alarm_integration_latency}",
          "${alarm_cache_hit_ratio}"
        ]
      }
    }
  ],
  "variables": [
    {
      "name": "service_name",
      "type": "text",
      "defaultValue": "api-gateway-rest",
      "description": "Service name for the API Gateway"
    },
    {
      "name": "environment",
      "type": "text", 
      "defaultValue": "dev",
      "description": "Environment (dev, staging, prod)"
    },
    {
      "name": "api_name",
      "type": "text",
      "defaultValue": "${api_name}",
      "description": "API Gateway API name"
    },
    {
      "name": "stage",
      "type": "text",
      "defaultValue": "${stage}",
      "description": "API Gateway stage name"
    },
    {
      "name": "region",
      "type": "text",
      "defaultValue": "${region}",
      "description": "AWS region"
    },
    {
      "name": "timestamp",
      "type": "text",
      "defaultValue": "${timestamp}",
      "description": "Dashboard last updated timestamp"
    }
  ],
  "annotations": {
    "horizontal": [
      {
        "label": "4XX Error Threshold",
        "value": 5
      },
      {
        "label": "5XX Error Threshold",
        "value": 1
      },
      {
        "label": "P95 Latency Threshold",
        "value": 1000
      }
    ]
  },
  "yAxes": {
    "left": {
      "min": 0,
      "max": 100
    },
    "right": {
      "min": 0
    }
  },
  "refresh": {
    "interval": 60
  },
  "timeRange": {
    "start": "-PT1H",
    "end": "P0D"
  },
  "timezone": "UTC"
}
